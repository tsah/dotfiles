#!/bin/bash
# Focus or launch persistent terminal anywhere; no auto-move

# Find existing persistent terminal window
client_info=$(hyprctl clients | awk '
  /^Window/ { 
    addr = $2
  }
  /^\tclass:/ {
    class = $2
  }
  /^\tworkspace:/ {
    workspace = $2
  }
  (class == "persistent-terminal" || class == "omarchy.persistentterminal") && workspace != "" {
    print addr " " workspace
    exit
  }
')

if [ -n "$client_info" ]; then
  addr=$(echo "$client_info" | awk '{print $1}')
  ws=$(echo "$client_info" | awk '{print $2}')
  hyprctl dispatch workspace "$ws"
  hyprctl dispatch focuswindow "address:0x$addr"
  exit 0
fi

# None found: launch on workspace 1 with config file
hyprctl dispatch exec "[workspace 1] uwsm app -- ghostty --config-file=$HOME/dotfiles/ghostty-persistent.conf"
