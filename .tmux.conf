set -g mouse on
if-shell 'test -x /usr/local/bin/zsh' 'set -g default-shell /usr/local/bin/zsh' 'set -g default-shell /usr/bin/zsh'

# Keep Wayland clipboard vars available inside tmux panes.
set -ga update-environment WAYLAND_DISPLAY
set -ga update-environment XDG_RUNTIME_DIR
set -ga update-environment DBUS_SESSION_BUS_ADDRESS

# Ctrl+B is the default prefix

# reload tmux conf
bind r source-file ~/.tmux.conf

# Vim style pane selection
bind h select-pane -L
bind j select-pane -D 
bind k select-pane -U
bind l select-pane -R

# Kill window without confirmation
bind x kill-window

set -g @plugin 'tmux-plugins/tpm'
# Start windows and panes at 1, not 0
set -g base-index 1
set -g pane-base-index 1
set-window-option -g pane-base-index 1
set-option -g renumber-windows on

# Direct Alt key bindings (no prefix needed)
bind -n M-t new-window -c "#{pane_current_path}"
unbind -n M-g
bind -n M-x run-shell 'current="$(tmux display-message -p "#S")"; tmux switch-client -n 2>/dev/null; tmux kill-session -t "$current"'
bind -n M-w kill-window
bind -n M-b run-shell "~/dotfiles/bin/tmux-wt-spawn.sh"
bind -n M-d new-window -c "#{pane_current_path}" "~/dotfiles/bin/wt destroy"
bind -n M-j copy-mode
bind -n M-k run-shell "~/dotfiles/bin/tmux-session-switcher.sh"

# Alt+number window switching
bind -n M-1 select-window -t 1
bind -n M-2 select-window -t 2
bind -n M-3 select-window -t 3
bind -n M-4 select-window -t 4
bind -n M-5 select-window -t 5
bind -n M-6 select-window -t 6
bind -n M-7 select-window -t 7
bind -n M-8 select-window -t 8
bind -n M-9 select-window -t 9



# Theme
# set -g @plugin 'jimeh/tmux-themepack'
# set -g @themepack 'powerline/default/blue'
# set -g @catppuccin_window_tabs_enabled on
# set -g @plugin 'dracula/tmux'
# set -g @dracula-show-powerline true
# set -g @dracula-show-flags true
# set -g @dracula-show-left-icon session
# loud or quiet?
set-option -g status-position top
set-option -g status-style bg=default,fg=default
set-option -g status-justify left
set-option -g status-left '#[bg=default,fg=default,bold]#{?client_prefix,,  tmux  }#[bg=#698DDA,fg=black,bold]#{?client_prefix,  tmux  ,}'
set-option -g status-right '#S'
set-option -g window-status-format ' #I:#W '
set-option -g window-status-current-format '#[bg=#698DDA,fg=black] #I:#W#{?window_zoomed_flag, Ôûí , }'

# Shift arrow to switch windows
bind -n S-Left  previous-window
bind -n S-Right next-window

# Move windows left and right
bind-key -n C-S-Left swap-window -t -1\; select-window -t -1
bind-key -n C-S-Right swap-window -t +1\; select-window -t +1


set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'christoomey/vim-tmux-navigator'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'tmux-plugins/tmux-open'
set -g @plugin 'tmux-plugins/tmux-pain-control'
set -g @plugin 'wfxr/tmux-fzf-url'
set -g @fzf-url-bind 'u'
# tmux-fzf-url: prefix + u opens URLs
set -g @plugin 'nhdaly/tmux-better-mouse-mode'
set -g @scroll-speed-num-lines-per-scroll 1

# set vi-mode
set-window-option -g mode-keys vi

# keybindings

bind-key "T" run-shell "sesh connect \"$(sesh list --icons | fzf-tmux -p 80%,70% --no-sort --ansi --border-label ' sesh ' --prompt '‚ö°  ' --header '  ^a all ^t tmux ^g configs ^x zoxide ^d tmux kill ^f find' --bind 'tab:down,btab:up' --bind 'ctrl-a:change-prompt(‚ö°  )+reload(sesh list --icons)' --bind 'ctrl-t:change-prompt(ü™ü  )+reload(sesh list -t --icons)' --bind 'ctrl-g:change-prompt(‚öôÔ∏è  )+reload(sesh list -c --icons)' --bind 'ctrl-x:change-prompt(üìÅ  )+reload(sesh list -z --icons)' --bind 'ctrl-f:change-prompt(üîé  )+reload(fd -H -d 2 -t d -E .Trash . ~)' --bind 'ctrl-d:execute(tmux kill-session -t {2..})+change-prompt(‚ö°  )+reload(sesh list --icons)' --preview-window 'right:55%' --preview 'sesh preview {}')\""

bind-key -T copy-mode-vi v send-keys -X begin-selection
bind-key -T copy-mode-vi C-v send-keys -X rectangle-toggle
bind-key -T copy-mode-vi y send-keys -X copy-selection-and-cancel
bind-key l switch-client -l

# Session cycling
bind -n M-n switch-client -n
bind -n M-p switch-client -p

bind '"' split-window -v -c "#{pane_current_path}"
bind % split-window -h -c "#{pane_current_path}"

# Smart pane switching with awareness of Neovim splits.
bind-key -n C-h if -F "#{@pane-is-vim}" 'send-keys C-h'  'select-pane -L'
bind-key -n C-j if -F "#{@pane-is-vim}" 'send-keys C-j'  'select-pane -D'
bind-key -n C-k if -F "#{@pane-is-vim}" 'send-keys C-k'  'select-pane -U'
bind-key -n C-l if -F "#{@pane-is-vim}" 'send-keys C-l'  'select-pane -R'

run '~/.tmux/plugins/tpm/tpm'

# Clipboard behavior for SSH + Ghostty: prefer OSC52, avoid external clipboard deps.
set -g set-clipboard on
set -ga update-environment "WAYLAND_DISPLAY"
set -ga update-environment "XDG_RUNTIME_DIR"
bind-key -T copy-mode-vi y send-keys -X copy-selection-and-cancel
bind-key -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-selection-and-cancel
bind-key -T copy-mode y send-keys -X copy-selection-and-cancel
bind-key -T copy-mode MouseDragEnd1Pane send-keys -X copy-selection-and-cancel

# Reliable clipboard paste into current pane (works through ssh/tmux nesting).
bind-key v run-shell -b "~/dotfiles/bin/tmux-paste-clipboard '#{pane_id}'"
bind-key -n C-S-v run-shell -b "~/dotfiles/bin/tmux-paste-clipboard '#{pane_id}'"
bind-key -n S-Insert run-shell -b "~/dotfiles/bin/tmux-paste-clipboard '#{pane_id}'"
bind-key -n MouseDown2Pane select-pane -t = \; if-shell -F "#{||:#{pane_in_mode},#{mouse_any_flag}}" { send-keys -M } { run-shell -b "~/dotfiles/bin/tmux-paste-clipboard '#{mouse_pane}'" }
