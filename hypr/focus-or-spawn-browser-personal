#!/bin/bash
# Focus or launch personal browser profile

USER_DATA_DIR="$HOME/.config/chromium-personal"

# Find existing personal browser window
client_info=$(hyprctl clients | awk '
  /^Window/ { 
    addr = $2
  }
  /^\tclass:/ {
    class = $2
  }
  /^\tworkspace:/ {
    workspace = $2
  }
  class == "chromium-personal" && workspace != "" {
    print addr " " workspace
    exit
  }
')

if [ -n "$client_info" ]; then
  addr=$(echo "$client_info" | awk '{print $1}')
  ws=$(echo "$client_info" | awk '{print $2}')
  # Only switch workspace if we're not already on it
  current_ws=$(hyprctl activeworkspace | head -1 | awk '{print $3}' | tr -d '()')
  if [ "$current_ws" != "$ws" ]; then
    hyprctl dispatch workspace "$ws"
  fi
  hyprctl dispatch focuswindow "address:0x$addr"
  exit 0
fi

# None found: launch new personal browser on workspace 5
hyprctl dispatch exec "[workspace 5] chromium --user-data-dir=\"${USER_DATA_DIR}\" --class=\"chromium-personal\" --ozone-platform=wayland --ozone-platform-hint=wayland --enable-features=UseOzonePlatform,TouchpadOverscrollHistoryNavigation"