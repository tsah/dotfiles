#!/bin/bash

# Get current window info
CURRENT_WINDOW=$(hyprctl activewindow -j 2>/dev/null)

# Check if there's no active window (empty workspace)
if [ $? -ne 0 ] || [ "$(echo "$CURRENT_WINDOW" | jq -r '.address')" = "null" ]; then
    # Empty workspace, just switch to next workspace
    hyprctl dispatch workspace +1
    exit 0
fi

CURRENT_POS=$(echo "$CURRENT_WINDOW" | jq -r '.at[0]')
CURRENT_WORKSPACE=$(echo "$CURRENT_WINDOW" | jq -r '.workspace.id')

# Get all windows on current workspace, sorted by x position
WINDOWS_ON_WS=$(hyprctl clients -j | jq -r ".[] | select(.workspace.id == $CURRENT_WORKSPACE) | .at[0]" | sort -n)

# Find the rightmost window position
RIGHTMOST_POS=$(echo "$WINDOWS_ON_WS" | tail -1)

# If we're already at the rightmost window, move to next workspace
if [ "$CURRENT_POS" = "$RIGHTMOST_POS" ]; then
    hyprctl dispatch movetoworkspace +1
    hyprctl dispatch movewindow l
else
    hyprctl dispatch movewindow r
fi
