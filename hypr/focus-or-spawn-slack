#!/bin/bash
# Focus or launch Slack web app

# Find existing Slack window (chrome-app.slack.com class)
client_info=$(hyprctl clients | awk '
  /^Window/ { 
    addr = $2
  }
  /^\tclass:/ {
    class = $2
  }
  /^\tworkspace:/ {
    workspace = $2
  }
  class ~ /chrome-app\.slack\.com/ && workspace != "" {
    print addr " " workspace
    exit
  }
')

if [ -n "$client_info" ]; then
  addr=$(echo "$client_info" | awk '{print $1}')
  ws=$(echo "$client_info" | awk '{print $2}')
  # Only switch workspace if we're not already on it
  current_ws=$(hyprctl activeworkspace | head -1 | awk '{print $3}' | tr -d '()')
  if [ "$current_ws" != "$ws" ]; then
    hyprctl dispatch workspace "$ws"
  fi
  hyprctl dispatch focuswindow "address:0x$addr"
  exit 0
fi

# None found: launch new Slack app on workspace 3
hyprctl dispatch workspace 3
hyprctl dispatch exec "chromium --app=\"https://app.slack.com/client/T086WDUM9LM/C087BVCGJ49\""