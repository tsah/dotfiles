#!/bin/bash

# Get current window info
CURRENT_WINDOW=$(hyprctl activewindow -j 2>/dev/null)

# Check if there's no active window (empty workspace)
if [ $? -ne 0 ] || [ "$(echo "$CURRENT_WINDOW" | jq -r '.address')" = "null" ]; then
    # Empty workspace, just switch to previous workspace
    hyprctl dispatch workspace -1
    exit 0
fi

CURRENT_POS=$(echo "$CURRENT_WINDOW" | jq -r '.at[0]')
CURRENT_WORKSPACE=$(echo "$CURRENT_WINDOW" | jq -r '.workspace.id')

# Get all windows on current workspace, sorted by x position
WINDOWS_ON_WS=$(hyprctl clients -j | jq -r ".[] | select(.workspace.id == $CURRENT_WORKSPACE) | .at[0]" | sort -n)

# Find the leftmost window position
LEFTMOST_POS=$(echo "$WINDOWS_ON_WS" | head -1)

# If we're already at the leftmost window, move to previous workspace
if [ "$CURRENT_POS" = "$LEFTMOST_POS" ]; then
    hyprctl dispatch movetoworkspace -1
    hyprctl dispatch movewindow r
else
    hyprctl dispatch movewindow l
fi
